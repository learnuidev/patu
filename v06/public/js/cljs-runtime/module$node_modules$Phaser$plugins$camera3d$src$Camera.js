shadow$provide.module$node_modules$Phaser$plugins$camera3d$src$Camera=function(global,require,module,exports){global=require("module$node_modules$Phaser$src$utils$Class");var Matrix4=require("module$node_modules$Phaser$src$math$Matrix4"),RandomXYZ=require("module$node_modules$Phaser$src$math$RandomXYZ"),RandomXYZW=require("module$node_modules$Phaser$src$math$RandomXYZW"),RotateVec3=require("module$node_modules$Phaser$src$math$RotateVec3"),Set=require("module$node_modules$Phaser$src$structs$Set"),
Sprite3D=require("module$node_modules$Phaser$plugins$camera3d$src$sprite3d$Sprite3D"),Vector2=require("module$node_modules$Phaser$src$math$Vector2"),Vector3=require("module$node_modules$Phaser$src$math$Vector3"),Vector4=require("module$node_modules$Phaser$src$math$Vector4"),tmpVec3=new Vector3,tmpVec4=new Vector4,dirvec=new Vector3,rightvec=new Vector3,billboardMatrix=new Matrix4,Camera=new global({initialize:function(scene){this.scene=scene;this.displayList=scene.sys.displayList;this.updateList=
scene.sys.updateList;this.name="";this.direction=new Vector3(0,0,-1);this.up=new Vector3(0,1,0);this.position=new Vector3;this.pixelScale=128;this.projection=new Matrix4;this.view=new Matrix4;this.combined=new Matrix4;this.invProjectionView=new Matrix4;this.near=1;this.far=100;this.ray={origin:new Vector3,direction:new Vector3};this.viewportHeight=this.viewportWidth=0;this.billboardMatrixDirty=!0;this.children=new Set},setPosition:function(x,y,z){this.position.set(x,y,z);return this.update()},setScene:function(scene){this.scene=
scene;return this},setPixelScale:function(value){this.pixelScale=value;return this.update()},add:function(sprite3D){this.children.set(sprite3D);this.displayList.add(sprite3D.gameObject);this.updateList.add(sprite3D.gameObject);this.updateChildren();return sprite3D},remove:function(child){this.displayList.remove(child.gameObject);this.updateList.remove(child.gameObject);this.children.delete(child);return this},clear:function(){for(var children=this.getChildren(),i=0;i<children.length;i++)this.remove(children[i]);
return this},getChildren:function(){return this.children.entries},create:function(x,y,z,key,frame,visible){void 0===visible&&(visible=!0);x=new Sprite3D(this.scene,x,y,z,key,frame);this.displayList.add(x.gameObject);this.updateList.add(x.gameObject);x.visible=visible;this.children.set(x);this.updateChildren();return x},createMultiple:function(quantity,key,frame,visible){void 0===visible&&(visible=!0);for(var output=[],i=0;i<quantity;i++){var child=new Sprite3D(this.scene,0,0,0,key,frame);this.displayList.add(child.gameObject);
this.updateList.add(child.gameObject);child.visible=visible;this.children.set(child);output.push(child)}return output},createRect:function(size,spacing,key,frame){"number"===typeof size&&(size={x:size,y:size,z:size});"number"===typeof spacing&&(spacing={x:spacing,y:spacing,z:spacing});key=this.createMultiple(size.x*size.y*size.z,key,frame);frame=0;for(var z=.5-size.z/2;z<size.z/2;z++)for(var y=.5-size.y/2;y<size.y/2;y++)for(var x=.5-size.x/2;x<size.x/2;x++)key[frame].position.set(x*spacing.x,y*spacing.y,
z*spacing.z),frame++;this.update();return key},randomSphere:function(radius,sprites){void 0===sprites&&(sprites=this.getChildren());for(var i=0;i<sprites.length;i++)RandomXYZ(sprites[i].position,radius);return this.update()},randomCube:function(scale,sprites){void 0===sprites&&(sprites=this.getChildren());for(var i=0;i<sprites.length;i++)RandomXYZW(sprites[i].position,scale);return this.update()},translateChildren:function(vec3,sprites){void 0===sprites&&(sprites=this.getChildren());for(var i=0;i<
sprites.length;i++)sprites[i].position.add(vec3);return this.update()},transformChildren:function(mat4,sprites){void 0===sprites&&(sprites=this.getChildren());for(var i=0;i<sprites.length;i++)sprites[i].position.transformMat4(mat4);return this.update()},setViewport:function(width,height){this.viewportWidth=width;this.viewportHeight=height;return this.update()},translate:function(x,y,z){"object"===typeof x?(this.position.x+=x.x||0,this.position.y+=x.y||0,this.position.z+=x.z||0):(this.position.x+=
x||0,this.position.y+=y||0,this.position.z+=z||0);return this.update()},lookAt:function(x,y,z){var dir=this.direction,up=this.up;"object"===typeof x?dir.copy(x):dir.set(x,y,z);dir.subtract(this.position).normalize();tmpVec3.copy(dir).cross(up).normalize();up.copy(tmpVec3).cross(dir).normalize();return this.update()},rotate:function(radians,axis){RotateVec3(this.direction,axis,radians);RotateVec3(this.up,axis,radians);return this.update()},rotateAround:function(point,radians,axis){tmpVec3.copy(point).subtract(this.position);
this.translate(tmpVec3);this.rotate(radians,axis);this.translate(tmpVec3.negate());return this.update()},project:function(vec,out){void 0===out&&(out=new Vector4);var viewportWidth=this.viewportWidth,viewportHeight=this.viewportHeight,n=Camera.NEAR_RANGE,f=Camera.FAR_RANGE;tmpVec4.set(vec.x,vec.y,vec.z,1);tmpVec4.transformMat4(this.combined);0===tmpVec4.w&&(tmpVec4.w=1);tmpVec4.x/=tmpVec4.w;tmpVec4.y/=tmpVec4.w;tmpVec4.z/=tmpVec4.w;out.x=viewportWidth/2*tmpVec4.x+viewportWidth/2;out.y=viewportHeight/
2*tmpVec4.y+viewportHeight/2;out.z=(f-n)/2*tmpVec4.z+(f+n)/2;if(0===out.w||out.w)out.w=1/tmpVec4.w;return out},unproject:function(vec,out){void 0===out&&(out=new Vector3);var viewport=tmpVec4.set(0,0,this.viewportWidth,this.viewportHeight);return out.copy(vec).unproject(viewport,this.invProjectionView)},getPickRay:function(x,y){var origin=this.ray.origin.set(x,y,0);x=this.ray.direction.set(x,y,1);y=tmpVec4.set(0,0,this.viewportWidth,this.viewportHeight);var mtx=this.invProjectionView;origin.unproject(y,
mtx);x.unproject(y,mtx);x.subtract(origin).normalize();return this.ray},updateChildren:function(){for(var children=this.children.entries,i=0;i<children.length;i++)children[i].project(this);return this},update:function(){return this.updateChildren()},updateBillboardMatrix:function(){var dir=dirvec.set(this.direction).negate(),right=rightvec.set(this.up).cross(dir).normalize(),up=tmpVec3.set(dir).cross(right).normalize(),out=billboardMatrix.val;out[0]=right.x;out[1]=right.y;out[2]=right.z;out[3]=0;
out[4]=up.x;out[5]=up.y;out[6]=up.z;out[7]=0;out[8]=dir.x;out[9]=dir.y;out[10]=dir.z;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;this.billboardMatrixDirty=!1},getPointSize:function(vec,size,out){void 0===out&&(out=new Vector2);this.billboardMatrixDirty&&this.updateBillboardMatrix();var dx=size.x/this.pixelScale/2;size=size.y/this.pixelScale/2;tmpVec3.set(-dx,-size,0).transformMat4(billboardMatrix).add(vec);this.project(tmpVec3,tmpVec3);var tlx=tmpVec3.x,tly=tmpVec3.y;tmpVec3.set(dx,size,0).transformMat4(billboardMatrix).add(vec);
this.project(tmpVec3,tmpVec3);return out.set(tmpVec3.x-tlx,tmpVec3.y-tly)},destroy:function(){this.children.clear();this.children=this.scene=void 0},setX:function(value){this.position.x=value;return this.update()},setY:function(value){this.position.y=value;return this.update()},setZ:function(value){this.position.z=value;return this.update()},x:{get:function(){return this.position.x},set:function(value){this.position.x=value;this.update()}},y:{get:function(){return this.position.y},set:function(value){this.position.y=
value;this.update()}},z:{get:function(){return this.position.z},set:function(value){this.position.z=value;this.update()}}});Camera.FAR_RANGE=1;Camera.NEAR_RANGE=0;module.exports=Camera}
//# sourceMappingURL=module$node_modules$Phaser$plugins$camera3d$src$Camera.js.map
