shadow$provide.module$node_modules$Phaser$src$gameobjects$rendertexture$RenderTexture=function(global,require,module,exports){var Camera=require("module$node_modules$Phaser$src$cameras$2d$BaseCamera"),CanvasPool=require("module$node_modules$Phaser$src$display$canvas$CanvasPool");global=require("module$node_modules$Phaser$src$utils$Class");exports=require("module$node_modules$Phaser$src$gameobjects$components$index");var CONST=require("module$node_modules$Phaser$src$const"),Frame=require("module$node_modules$Phaser$src$textures$Frame"),
GameObject=require("module$node_modules$Phaser$src$gameobjects$GameObject"),Render=require("module$node_modules$Phaser$src$gameobjects$rendertexture$RenderTextureRender"),UUID=require("module$node_modules$Phaser$src$utils$string$UUID");require=new global({Extends:GameObject,Mixins:[exports.Alpha,exports.BlendMode,exports.ComputedSize,exports.Crop,exports.Depth,exports.Flip,exports.GetBounds,exports.Mask,exports.Origin,exports.Pipeline,exports.ScaleMode,exports.ScrollFactor,exports.Tint,exports.Transform,
exports.Visible,Render],initialize:function(scene,x,y,width,height){void 0===x&&(x=0);void 0===y&&(y=0);void 0===width&&(width=32);void 0===height&&(height=32);GameObject.call(this,scene,"RenderTexture");this.renderer=scene.sys.game.renderer;this.textureManager=scene.sys.textures;this.globalTint=16777215;this.globalAlpha=1;this.canvas=CanvasPool.create2D(this,width,height);this.context=this.canvas.getContext("2d");this.framebuffer=null;this._crop=this.resetCropObject();this.texture=scene.sys.textures.addCanvas(UUID(),
this.canvas);this.frame=this.texture.get();this._saved=!1;this.camera=new Camera(0,0,width,height);this.dirty=!1;this.gl=null;var renderer=this.renderer;renderer.type===CONST.WEBGL?(this.gl=renderer.gl,this.drawGameObject=this.batchGameObjectWebGL,this.framebuffer=renderer.createFramebuffer(width,height,this.frame.source.glTexture,!1)):renderer.type===CONST.CANVAS&&(this.drawGameObject=this.batchGameObjectCanvas);this.camera.setScene(scene);this.setPosition(x,y);this.setSize(width,height);this.setOrigin(0,
0);this.initPipeline()},setSize:function(width,height){return this.resize(width,height)},resize:function(width,height){void 0===height&&(height=width);if(width!==this.width||height!==this.height){this.canvas.width=width;this.canvas.height=height;if(this.gl){var gl=this.gl;this.renderer.deleteTexture(this.frame.source.glTexture);this.renderer.deleteFramebuffer(this.framebuffer);this.frame.source.glTexture=this.renderer.createTexture2D(0,gl.NEAREST,gl.NEAREST,gl.CLAMP_TO_EDGE,gl.CLAMP_TO_EDGE,gl.RGBA,
null,width,height,!1);this.framebuffer=this.renderer.createFramebuffer(width,height,this.frame.source.glTexture,!1);this.frame.glTexture=this.frame.source.glTexture}this.frame.source.width=width;this.frame.source.height=height;this.camera.setSize(width,height);this.frame.setSize(width,height);this.width=width;this.height=height}return this},setGlobalTint:function(tint){this.globalTint=tint;return this},setGlobalAlpha:function(alpha){this.globalAlpha=alpha;return this},saveTexture:function(key){this.textureManager.renameTexture(this.texture.key,
key);this._saved=!0;return this.texture},fill:function(rgb,alpha){void 0===alpha&&(alpha=1);var ur=(rgb>>16|0)&255,ug=(rgb>>8|0)&255;rgb=(rgb|0)&255;if(this.gl){this.renderer.setFramebuffer(this.framebuffer);var gl=this.gl;gl.clearColor(ur/255,ug/255,rgb/255,alpha);gl.clear(gl.COLOR_BUFFER_BIT);this.renderer.setFramebuffer(null)}else this.context.fillStyle="rgb("+ur+","+ug+","+rgb+")",this.context.fillRect(0,0,this.canvas.width,this.canvas.height);return this},clear:function(){if(this.dirty){if(this.gl){this.renderer.setFramebuffer(this.framebuffer);
var gl=this.gl;gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);this.renderer.setFramebuffer(null)}else gl=this.context,gl.save(),gl.setTransform(1,0,0,1,0,0),gl.clearRect(0,0,this.canvas.width,this.canvas.height),gl.restore();this.dirty=!1}return this},draw:function(entries,x,y,alpha,tint){void 0===alpha&&(alpha=this.globalAlpha);tint=void 0===tint?(this.globalTint>>16)+(this.globalTint&65280)+((this.globalTint&255)<<16):(tint>>16)+(tint&65280)+((tint&255)<<16);Array.isArray(entries)||(entries=
[entries]);var gl=this.gl;this.camera.preRender(1,1,1);gl?(this.renderer.setFramebuffer(this.framebuffer),gl=this.pipeline,gl.projOrtho(0,this.width,0,this.height,-1E3,1E3),this.batchList(entries,x,y,alpha,tint),gl.flush(),this.renderer.setFramebuffer(null),gl.projOrtho(0,gl.width,gl.height,0,-1E3,1E3)):(this.renderer.setContext(this.context),this.batchList(entries,x,y,alpha,tint),this.renderer.setContext());this.dirty=!0;return this},drawFrame:function(key,frame,x,y,alpha,tint){void 0===x&&(x=0);
void 0===y&&(y=0);void 0===alpha&&(alpha=this.globalAlpha);tint=void 0===tint?(this.globalTint>>16)+(this.globalTint&65280)+((this.globalTint&255)<<16):(tint>>16)+(tint&65280)+((tint&255)<<16);var gl=this.gl;if(key=this.textureManager.getFrame(key,frame))this.camera.preRender(1,1,1),gl?(this.renderer.setFramebuffer(this.framebuffer),gl=this.pipeline,gl.projOrtho(0,this.width,0,this.height,-1E3,1E3),gl.batchTextureFrame(key,x,y,tint,alpha,this.camera.matrix,null),gl.flush(),this.renderer.setFramebuffer(null),
gl.projOrtho(0,gl.width,gl.height,0,-1E3,1E3)):this.batchTextureFrame(key,x,y,alpha,tint),this.dirty=!0;return this},batchList:function(children,x,y,alpha,tint){for(var i=0;i<children.length;i++){var entry=children[i];entry&&entry!==this&&(entry.renderWebGL||entry.renderCanvas?this.drawGameObject(entry,x,y):entry.isParent||entry.list?this.batchGroup(entry.getChildren(),x,y):"string"===typeof entry?this.batchTextureFrameKey(entry,null,x,y,alpha,tint):entry instanceof Frame?this.batchTextureFrame(entry,
x,y,alpha,tint):Array.isArray(entry)&&this.batchList(entry,x,y,alpha,tint))}},batchGroup:function(children,x,y){void 0===x&&(x=0);void 0===y&&(y=0);for(var i=0;i<children.length;i++){var entry=children[i];entry.willRender()&&this.drawGameObject(entry,entry.x+x,entry.y+y)}},batchGameObjectWebGL:function(gameObject,x,y){void 0===x&&(x=gameObject.x);void 0===y&&(y=gameObject.y);var prevX=gameObject.x,prevY=gameObject.y;this.renderer.setBlendMode(gameObject.blendMode);gameObject.setPosition(x,y);gameObject.renderWebGL(this.renderer,
gameObject,0,this.camera,null);gameObject.setPosition(prevX,prevY)},batchGameObjectCanvas:function(gameObject,x,y){void 0===x&&(x=gameObject.x);void 0===y&&(y=gameObject.y);var prevX=gameObject.x,prevY=gameObject.y;gameObject.setPosition(x,y);gameObject.renderCanvas(this.renderer,gameObject,0,this.camera,null);gameObject.setPosition(prevX,prevY)},batchTextureFrameKey:function(key,frame,x,y,alpha,tint){(key=this.textureManager.getFrame(key,frame))&&this.batchTextureFrame(key,x,y,alpha,tint)},batchTextureFrame:function(textureFrame,
x,y,alpha,tint){void 0===x&&(x=0);void 0===y&&(y=0);if(this.gl)this.pipeline.batchTextureFrame(textureFrame,x,y,tint,alpha,this.camera.matrix,null);else{alpha=this.context;tint=textureFrame.canvasData;textureFrame=textureFrame.source.image;var matrix=this.camera.matrix;alpha.globalAlpha=this.globalAlpha;alpha.setTransform(matrix[0],matrix[1],matrix[2],matrix[3],matrix[4],matrix[5]);alpha.drawImage(textureFrame,tint.x,tint.y,tint.width,tint.height,x,y,tint.width,tint.height)}},preDestroy:function(){this._saved||
(CanvasPool.remove(this.canvas),this.gl&&this.renderer.deleteFramebuffer(this.framebuffer),this.texture.destroy())}});module.exports=require}
//# sourceMappingURL=module$node_modules$Phaser$src$gameobjects$rendertexture$RenderTexture.js.map
