{"version":3,"sources":["app/phaser/pokemon_two.cljs"],"mappings":"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","names":["js/app","js/app.phaser","js/app.phaser.pokemon-two","js/app.phaser.pokemon-two.app-db","app.phaser.pokemon-two/app-db","cljs.core.atom","app.phaser.pokemon-two/Color","js/Phaser","js/app.phaser.pokemon-two.controls","app.phaser.pokemon-two/controls","js/app.phaser.pokemon-two.scene","app.phaser.pokemon-two/scene","app.phaser.pokemon-two/preload!","this","js/window","app.phaser.pokemon-two/arrows-config","app.phaser.pokemon-two/create!","map","cljs.core/clj->js","_","tileset","below-layer","world-layer","above-layer","debugGraphics","spawn-point","obj","cljs.core._EQ_","new-player","cljs.core.swap_BANG_","cljs.core/assoc","cljs.core/deref","anims","camera","cursors","title","config","js/Phaser.Cameras.Controls.FixedKeyControl","app.phaser.pokemon-two/update!","_time","delta","map__28814","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","player","speed","prev-velocity","app.phaser.pokemon-two/config","app.phaser.pokemon-two/create-game","js/Phaser.Game","app.phaser.pokemon-two/app","game"],"sourcesContent":["(ns app.phaser.pokemon-two\n  (:require [cljs.reader :as reader]\n            [reagent.core :as r]\n            [\"Phaser\" :as Phaser]))\n\n;; - Step 0 - Create game state\n(defonce app-db (atom {:cursors nil\n                       :player nil\n                       :show-debug? false}))\n\n(def Color (.. js/Phaser -Display -Color))\n(comment\n ;;  const prevVelocity = player.body.velocity.clone();\n  (-> (:player (deref app-db)) .-body .-velocity .clone)\n  (:player (deref app-db)))\n\n;;\n;; ==================\n(declare preload)\n(declare create)\n\n;; Utils ===\n(defonce controls #js {})\n\n;; step 1 - create a new game scene\n(defonce scene #js {})\n\n;; step 3 - load assets\n(defn preload! []\n  (this-as this\n           (set! js/window -that this)\n           (.image (.-load this) \"tiles\" \"https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-1/assets/tilesets/tuxmon-sample-32px-extruded.png\")\n           (.tilemapTiledJSON (.-load this) \"map\", \"https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-1/assets/tilemaps/tuxemon-town.json\")\n           (.atlas (.-load this) \"atlas\" \"https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-1/assets/atlas/atlas.png\" \"https://www.mikewesthad.com/phaser-3-tilemap-blog-posts/post-1/assets/atlas/atlas.json\")))\n\n(set! scene -preload preload!)\n\n;; step 4 - called once the preload ends\n(def arrows-config\n  {:font \"18px monospace\"\n   :fill \"#ffffff\"\n   :padding {:x 20, :y 10}\n   :backgroundColor \"#000000\"})\n\n(defn create! []\n  (this-as this\n           (set! js/window -that this)\n           (let [map (.tilemap (.-make this) (clj->js {:key \"map\"}))\n                 _ (set! js/window -gameMap map)\n                 tileset (.addTilesetImage map \"tuxmon-sample-32px-extruded\", \"tiles\")\n                 below-layer (.createStaticLayer map \"Below Player\", tileset, 0, 0)\n                 world-layer (.createStaticLayer map \"World\", tileset, 0, 0)\n                 above-layer (.createStaticLayer map \"Above Player\", tileset, 0, 0)\n                 _ (.setCollisionByProperty world-layer (clj->js {:collides true}))\n                 ;; Debugging Purpose\n                 debugGraphics (.setAlpha (.graphics (.-add this)) 0.75)\n                 _ (.renderDebug world-layer debugGraphics (clj->js {:tileColor nil   ;; Color of non-colliding tiles\n                                                                     :collidingTileColor (new Color 243, 134, 48, 255),  ;; Color of colliding tiles\n                                                                     :faceColor (new Color 40, 39, 37, 255)}))  ;; Color of colliding face edges}))\n                 ; _ (.setDepth above-layer 10)\n                 spawn-point (.findObject map \"Objects\" (fn [obj]\n                                                          (= (.-name obj) \"Spawn Point\")))\n                 new-player (-> (.-add (.-physics this))\n                                (.sprite (.-x spawn-point) (.-y spawn-point) \"atlas\" \"misa-front\")\n                                (.setSize 30 40)\n                                (.setOffset 0 24))\n                 _ (swap! app-db assoc :player new-player)\n                 _ (.collider (.-add (.-physics this)) (:player @app-db) world-layer)\n\n                 ;; Create the player's walking animations from the texture atlas.\n                 ;; These are stored in the global\n                 anims (.-anims this)\n                 _ (.create anims (clj->js {:key \"misa-left-walk\"\n                                            :frameRate 10\n                                            :releat -1\n                                            :frames (.generateFrameNames\n                                                     anims\n                                                     \"atlas\"\n                                                     (clj->js {:prefix \"misa-left-walk.\"\n                                                               :start 0\n                                                               :end 3\n                                                               :zeroPad 3}))}))\n                 _ (.create anims (clj->js {:key \"misa-right-walk\"\n                                            :frameRate 10\n                                            :releat -1\n                                            :frames (.generateFrameNames\n                                                     anims\n                                                     \"atlas\"\n                                                     (clj->js {:prefix \"misa-right-walk.\"\n                                                               :start 0\n                                                               :end 3\n                                                               :zeroPad 3}))}))\n                 _ (.create anims (clj->js {:key \"misa-front-walk\"\n                                            :frameRate 10\n                                            :releat -1\n                                            :frames (.generateFrameNames\n                                                     anims\n                                                     \"atlas\"\n                                                     (clj->js {:prefix \"misa-front-walk.\"\n                                                               :start 0\n                                                               :end 3\n                                                               :zeroPad 3}))}))\n                 _ (.create anims (clj->js {:key \"misa-back-walk\"\n                                            :frameRate 10\n                                            :releat -1\n                                            :frames (.generateFrameNames\n                                                     anims\n                                                     \"atlas\"\n                                                     (clj->js {:prefix \"misa-back-walk.\"\n                                                               :start 0\n                                                               :end 3\n                                                               :zeroPad 3}))}))\n                 camera (.-main (.-cameras this))\n                 _ (.startFollow camera (:player @app-db))\n                 cursors (.createCursorKeys (.-keyboard (.-input this)))\n                 _ (swap! app-db assoc :cursors cursors)\n                 title \"Arrow keys to move\\nPress 'D' to show hitboxes\"\n                 _ (->  (.-add this)\n                        (.text  16 16 title (clj->js {:font \"18px monospace\"\n                                                      :fill \"#000000\"\n                                                      :padding {:x 20 :y 10}\n                                                      :backgroundColor \"#ffffff\"}))\n                        (.setScrollFactor 0)\n                        (.setDepth 0))\n                 config {:camera camera\n                         :left  (.-left cursors)\n                         :right (.-right cursors)\n                         :up    (.-up cursors)\n                         :down  (.-down cursors)\n                         :speed 0.5}]\n                 ; controls (new js/Phaser.Cameras.Controls.FixedKeyControl (clj->js config))\n             (set! controls -controls (new js/Phaser.Cameras.Controls.FixedKeyControl (clj->js config)))\n             (.setBounds camera 0, 0, (.-widthInPixels map) (.-heightInPixels map))\n             (.setScrollFactor (.text (.-add this) 16 16 \"Arrows keys to scroll\" (clj->js arrows-config))\n                               0))))\n\n(set! scene -create create!)\n\n;;\n(comment\n ;;  const prevVelocity = player.body.velocity.clone();\n  (-> (:player (deref app-db)) .-body .-velocity .clone)\n  (:player (deref app-db)))\n\n;; Update\n(defn update! [_time delta]\n  ; (js/console.log \"DELTA: \" delta)\n  (let [{:keys [player cursors]} (deref app-db)\n        speed 175\n        prev-velocity  (-> player .-body .-velocity .clone)\n        _ (.setVelocity (.-body player) 0)\n        _ (if (-> cursors .-left .-isDown)\n            (.setVelocityX (.-body player) (- speed))\n            (when (-> cursors .-right .-isDown)\n              (.setVelocityX (.-body player) speed)))\n        _ (if (-> cursors .-up .-isDown)\n            (.setVelocityY (.-body player) (- speed))\n            (when (-> cursors .-down .-isDown)\n              (.setVelocityY (.-body player) speed)))\n        _ (.scale (.normalize (.-velocity (.-body player))) speed)\n        _ (if (-> cursors .-left .-isDown)\n            (.play (.-anims player) \"misa-left-walk\" true)\n            (if (-> cursors .-right .-isDown)\n              (.play (.-anims player) \"misa-right-walk\" true)\n              (if (-> cursors .-up .-isDown)\n                (.play (.-anims player) \"misa-back-walk\" true)\n                (when (-> cursors .-down .-isDown)\n                  (.play (.-anims player) \"misa-front-walk\" true)))))]\n\n    (.update (.-controls controls) delta)))\n\n(set! scene -update update!)\n\n;; step 2 - set the configuration of the game\n(def config\n  {:type (.-AUTO js/Phaser)\n   :width 800\n   :height 600\n   :parent \"game-container\"\n   :pixelArt true\n   :physics\n   {:default \"arcade\"\n    :arcade {:gravity {:y 0}}}\n   :scene scene})\n\n;; Step 5 - create a game\n(defn create-game []\n  (new js/Phaser.Game (clj->js config)))\n\n(defn app []\n  (let [game (create-game)]\n    (set! js/window -game game)))\n"]}