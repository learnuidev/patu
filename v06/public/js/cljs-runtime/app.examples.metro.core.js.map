{"version":3,"sources":["app/examples/metro/core.cljs"],"mappings":"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","names":["app.patu.core.init","js/document.getElementById","app.patu.loaders.load_root","app.patu.loaders.load_sprite","app.examples.metro.core/sleep","f","ms","js/setTimeout","p__32603","vec__32604","cljs.core.nth","app.examples.metro.core/change-sprite","id","sid","aid","temp__5735__auto__","comp","app.patu.core/get-component","cljs.core/name","app.patu.core/play","app.examples.metro.core/change-sprite-and-destroy","app.patu.core/destroy","app.examples.metro.core/attack","app.patu.components/cur-anim?","app.patu.core/reg-level","app.examples.metro.assets/level-handler","app.examples.metro.assets/level-two-handler","app.patu.core/reg-scene","app.examples.metro.scenes.one/init","app.examples.metro.scenes.one/event","app.examples.metro.scenes.two/init","app.examples.metro.scenes.two/event","score","vec__32607","x","y","app.patu.core/center","app.patu.core.go","app.examples.metro.core/app","app.patu.core/start"],"sourcesContent":["(ns app.examples.metro.core\n  (:require\n   [clojure.repl :refer [doc]]\n   ;; Main Libs ===\n   [app.patu.core :as p]\n   [app.patu.loaders :as l]\n   [app.patu.cam :as cam]\n   [app.patu.audio :as a]\n   [app.patu.components :as c]\n   [app.patu.utils :refer [js-get]]\n   ;; Event System\n   [app.patu.events :refer [dispatch reg-event key-down?]]\n   ;; ======= Game =======\n   ;; 1. Assets\n   [app.examples.metro.assets :refer [main-map level-handler level-two-handler]]\n   ;; 2. Events\n   [app.examples.metro.events]\n   ;; 3. Scenes\n   [app.examples.metro.scenes.one :as one]\n   [app.examples.metro.scenes.two :as two]))\n\n(comment\n  (js/console.clear)\n  (doc p/start)\n  (doc p/init))\n\n;; Step 1: Initialize Game\n(p/init {:canvas (js/document.getElementById \"app\")\n         :fullscreen true\n         :scale 2\n         :debug true\n         :clearColor [0 0 0 1]})\n;; Load Assets\n(l/load-root \"assets/metro/\")\n(l/load-sprite :bg0 \"tiles/bg_0.png\")\n(l/load-sprite :bg1 \"tiles/bg_1.png\")\n(l/load-sprite :bg2 \"tiles/bg_2.png\")\n(l/load-sprite :fg0 \"tiles/fg_1.png\")\n(l/load-sprite\n :tiles\n \"tiles/tileset32.png\"\n {:sliceX 12\n  :sliceY 6})\n\n(l/load-sprite\n :coin\n \"misc/coin_anim_strip_6.png\"\n {:sliceX 6\n  :anims {:coin {:from 0 :to 5}}})\n\n(l/load-sprite\n :coin-pickup\n \"misc/coin_pickup_anim_strip_6.png\"\n {:sliceX 6\n  :anims {:coin-pickup {:from 0 :to 5}}})\n\n(l/load-sprite\n :door/closed\n \"misc/strange_door_closed_anim_strip_10.png\"\n {:sliceX 10\n  :anims {:door/closed {:from 0 :to 9}}})\n(l/load-sprite\n :door-open\n \"misc/strange_door_opening_anim_strip_14.png\"\n {:sliceX 14\n  :anims {:door-open {:from 0 :to 13}}})\n\n;;\n(l/load-sprite :trap/suspended\n               \"misc/trap_suspended_anim_strip_18.png\"\n               {:sliceX 18\n                :anims {:pendulum {:from 0 :to 17}}})\n\n(l/load-sprite :explosion\n               \"misc/explosion_anim_strip_10.png\"\n               {:sliceX 10\n                :anims {:explosion {:from 0 :to 9}}})\n(l/load-sprite :tiki-torch\n               \"misc/tiki_torch_props_strip_12.png\"\n               {:sliceX 12\n                :anims {:tiki-torch {:from 0 :to 11}}})\n;;\n(l/load-sprite :orb-anim\n               \"misc/orb_anim_strip_6.png\"\n               {:sliceX 6\n                :anims {:orb-anim {:from 0 :to 5}}})\n(l/load-sprite :orb-pickup\n               \"misc/orb_collected_anim_strip_5.png\"\n               {:sliceX 5\n                :anims {:orb-pickup {:from 0 :to 4}}})\n\n(l/load-sprite :wooden-plate \"misc/wooden_plate.png\")\n(l/load-sprite :flower-props \"misc/flowers_props.png\")\n(l/load-sprite :grass-props \"misc/grass_props.png\")\n\n;; Lever\n(l/load-sprite :lever-right \"misc/lever_turned_right.png\")\n(l/load-sprite :lever-left \"misc/lever_turned_left.png\")\n\n;\n(l/load-sprite\n :bird\n \"fauna/bird_flying_anim_strip_3.png\"\n {:sliceX 3\n  :anims {:flying {:from 0 :to 2}}})\n\n;; === CHaracter Animations ===\n(l/load-sprite :character\n               \"hero/herochar_idle_anim_strip_4.png\"\n               {:sliceX 4\n                :anims {:idle {:from 0 :to 3}}})\n\n(l/load-sprite :character/tileset\n               \"hero/herochar_spritesheet.png\"\n               {:sliceX 8\n                :sliceY 15\n                :anims {:player/lose {:from 0 :to 7}\n                        :player/run {:from 8 :to 13}\n                        :player/boom {:from 16 :to 21}\n                        :player/nod {:from 24 :to 27}}})\n\n(l/load-sprite :character/attack\n               \"hero/herochar_sword_attack_anim_strip_4.png\"\n               {:sliceX 4\n                :anims {:attack {:from 0 :to 3}}})\n\n(l/load-sprite :character/death\n               \"hero/herochar_death_anim_strip_8.png\"\n               {:sliceX 8\n                :anims {:attack {:from 0 :to 7}}})\n\n(l/load-sprite :character/hit\n               \"hero/herochar_hit_anim_strip_3.png\"\n               {:sliceX 3\n                :anims {:attack {:from 0 :to 2}}})\n\n;; Enemies\n;; 1. Worm = 3 Animations\n(l/load-sprite :worm-walk\n               \"enemies/worm/worm_walk_anim_strip_6.png\"\n               {:sliceX 6\n                :anims {:worm-walk {:from 0 :to 5}}})\n(l/load-sprite :worm-hit\n               \"enemies/worm/worm_hit_anim_strip_3.png\"\n               {:sliceX 3\n                :anims {:worm-hit {:from 0 :to 2}}})\n(l/load-sprite :worm-death\n               \"enemies/worm/worm_death_anim_strip_6.png\"\n               {:sliceX 6\n                :anims {:worm-death {:from 0 :to 5}}})\n;; ===\n;; 2. Slime\n(l/load-sprite :slime-walk\n               \"enemies/slime/slime_walk_anim_strip_15.png\"\n               {:sliceX 15\n                :anims {:slime-walk {:from 0 :to 14}}})\n\n;;\n(defn sleep [f ms]\n  (js/setTimeout f ms))\n\n(defn change-sprite\n  [[id sid aid]]\n  (when-let [comp (p/get-component id)]\n    (.changeSprite comp (name sid))\n    (when aid\n      (p/play id aid))))\n\n(defn change-sprite-and-destroy\n  [comp sid aid]\n  (.changeSprite comp (name sid))\n  (when aid\n    (p/play comp aid))\n  (sleep #(p/destroy comp) 600))\n\n(defn attack\n  \"Triggers attack animation\"\n  [id]\n  (when-let [comp (p/get-component id)]\n    (when (not (c/cur-anim? comp :attack))\n      (.changeSprite comp (name :character/attack))\n      (p/play id :attack)\n      (sleep #(change-sprite [:player :character/tileset :player/nod])\n             300))))\n\n(comment\n  \"=== List of Game Animations === \"\n  (p/play :player :player/lose)\n  (p/play :player :player/run)\n  (p/play :player :player/boom)\n  (p/play :player :player/nod)\n  (p/play :player :player/attack)\n  (attack :player))\n\n(comment\n  \"Flipping Player Tutorial:\"\n  (.flipX (p/get-component :player) -1)\n  (.flipX (p/get-component :player) 1))\n;;\n(p/reg-level :level/main level-handler)\n(p/reg-level :level/two level-two-handler)\n\n;;\n(comment\n  (c/cur-anim? (p/get-component :player) :player/run)\n  (c/cur-anim (p/get-component :player))\n  (js/console.log (p/get-component :player))\n  (set! (p/get-component :player) -animSpeed 0.2))\n\n;; Scenees\n(p/reg-scene :scene/one {:init one/init\n                         :evt one/event})\n\n(p/reg-scene :scene/two {:init two/init\n                         :evt two/event})\n(p/reg-scene :scene/lose {:init (fn [score]\n                                  (let [[x y] (p/center)]\n                                    [[:comp/reg-n\n                                      [:dialog\n                                       [[:text score 40]\n                                        [:origin :center]\n                                        [:pos [x y]]]]\n                                      [:dialog-2\n                                       [[:text \"Press space to restart\" 10]\n                                        [:origin :center]\n                                        [:pos [x (+ 80 y)]]]]]]))\n                          :evt (fn []\n                                 [[:evt/key-press :space #(p/go :scene/one)]])})\n\n(defn app []\n  (p/start :scene/one))\n"]}