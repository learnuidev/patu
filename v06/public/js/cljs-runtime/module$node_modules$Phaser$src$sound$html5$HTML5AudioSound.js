shadow$provide.module$node_modules$Phaser$src$sound$html5$HTML5AudioSound=function(global,require,module,exports){var BaseSound=require("module$node_modules$Phaser$src$sound$BaseSound");global=new (require("module$node_modules$Phaser$src$utils$Class"))({Extends:BaseSound,initialize:function(manager,key,config){void 0===config&&(config={});(this.tags=manager.game.cache.audio.get(key))?(this.audio=null,this.previousTime=this.startTime=0,this.duration=this.tags[0].duration,this.totalDuration=this.tags[0].duration,
BaseSound.call(this,manager,key,config)):console.warn("Audio cache entry missing: "+key)},play:function(markerName,config){if(this.manager.isLocked(this,"play",[markerName,config])||!BaseSound.prototype.play.call(this,markerName,config)||!this.pickAndPlayAudioTag())return!1;this.emit("play",this);return!0},pause:function(){if(this.manager.isLocked(this,"pause")||0<this.startTime||!BaseSound.prototype.pause.call(this))return!1;this.currentConfig.seek=this.audio.currentTime-(this.currentMarker?this.currentMarker.start:
0);this.stopAndReleaseAudioTag();this.emit("pause",this);return!0},resume:function(){if(this.manager.isLocked(this,"resume")||0<this.startTime||!BaseSound.prototype.resume.call(this)||!this.pickAndPlayAudioTag())return!1;this.emit("resume",this);return!0},stop:function(){if(this.manager.isLocked(this,"stop")||!BaseSound.prototype.stop.call(this))return!1;this.stopAndReleaseAudioTag();this.emit("stop",this);return!0},pickAndPlayAudioTag:function(){if(!this.pickAudioTag())return this.reset(),!1;var delay=
this.currentConfig.delay,offset=(this.currentMarker?this.currentMarker.start:0)+this.currentConfig.seek;this.previousTime=offset;this.audio.currentTime=offset;this.applyConfig();0===delay?(this.startTime=0,this.audio.paused&&this.playCatchPromise()):(this.startTime=window.performance.now()+1E3*delay,this.audio.paused||this.audio.pause());this.resetConfig();return!0},pickAudioTag:function(){if(this.audio)return!0;for(var i=0;i<this.tags.length;i++){var audio=this.tags[i];if("false"===audio.dataset.used)return audio.dataset.used=
"true",this.audio=audio,!0}if(!this.manager.override)return!1;var otherSounds=[];this.manager.forEachActiveSound(function(sound){sound.key===this.key&&sound.audio&&otherSounds.push(sound)},this);otherSounds.sort(function(a1,a2){return a1.loop===a2.loop?a2.seek/a2.duration-a1.seek/a1.duration:a1.loop?1:-1});i=otherSounds[0];this.audio=i.audio;i.reset();i.audio=null;i.startTime=0;i.previousTime=0;return!0},playCatchPromise:function(){var playPromise=this.audio.play();playPromise&&playPromise.catch(function(reason){console.warn(reason)})},
stopAndReleaseAudioTag:function(){this.audio.pause();this.audio.dataset.used="false";this.audio=null;this.previousTime=this.startTime=0},reset:function(){BaseSound.prototype.stop.call(this)},onBlur:function(){this.isPlaying=!1;this.isPaused=!0;this.currentConfig.seek=this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0);this.currentConfig.delay=Math.max(0,(this.startTime-window.performance.now())/1E3);this.stopAndReleaseAudioTag()},onFocus:function(){this.isPlaying=!0;this.isPaused=
!1;this.pickAndPlayAudioTag()},update:function(time,delta){if(this.isPlaying)if(0<this.startTime)this.startTime<time-this.manager.audioPlayDelay&&(this.audio.currentTime+=Math.max(0,time-this.startTime)/1E3,this.startTime=0,this.previousTime=this.audio.currentTime,this.playCatchPromise());else{time=this.currentMarker?this.currentMarker.start:0;delta=time+this.duration;var currentTime=this.audio.currentTime;if(this.currentConfig.loop)currentTime>=delta-this.manager.loopEndOffset?(this.audio.currentTime=
time+Math.max(0,currentTime-delta),currentTime=this.audio.currentTime):currentTime<time&&(this.audio.currentTime+=time,currentTime=this.audio.currentTime),currentTime<this.previousTime&&this.emit("looped",this);else if(currentTime>=delta){this.reset();this.stopAndReleaseAudioTag();this.emit("ended",this);return}this.previousTime=currentTime}},destroy:function(){BaseSound.prototype.destroy.call(this);this.tags=null;this.audio&&this.stopAndReleaseAudioTag()},updateMute:function(){this.audio&&(this.audio.muted=
this.currentConfig.mute||this.manager.mute)},updateVolume:function(){this.audio&&(this.audio.volume=this.currentConfig.volume*this.manager.volume)},calculateRate:function(){BaseSound.prototype.calculateRate.call(this);this.audio&&(this.audio.playbackRate=this.totalRate)},mute:{get:function(){return this.currentConfig.mute},set:function(value){this.currentConfig.mute=value;this.manager.isLocked(this,"mute",value)||this.emit("mute",this,value)}},setMute:function(value){this.mute=value;return this},
volume:{get:function(){return this.currentConfig.volume},set:function(value){this.currentConfig.volume=value;this.manager.isLocked(this,"volume",value)||this.emit("volume",this,value)}},setVolume:function(value){this.volume=value;return this},rate:{get:function(){return this.currentConfig.rate},set:function(value){this.currentConfig.rate=value;this.manager.isLocked(this,"rate",value)||(this.calculateRate(),this.emit("rate",this,value))}},setRate:function(value){this.rate=value;return this},detune:{get:function(){return this.currentConfig.detune},
set:function(value){this.currentConfig.detune=value;this.manager.isLocked(this,"detune",value)||(this.calculateRate(),this.emit("detune",this,value))}},setDetune:function(value){this.detune=value;return this},seek:{get:function(){return this.isPlaying?this.audio.currentTime-(this.currentMarker?this.currentMarker.start:0):this.isPaused?this.currentConfig.seek:0},set:function(value){this.manager.isLocked(this,"seek",value)||0<this.startTime||!this.isPlaying&&!this.isPaused||(value=Math.min(Math.max(0,
value),this.duration),this.isPlaying?(this.previousTime=value,this.audio.currentTime=value):this.isPaused&&(this.currentConfig.seek=value),this.emit("seek",this,value))}},setSeek:function(value){this.seek=value;return this},loop:{get:function(){return this.currentConfig.loop},set:function(value){this.currentConfig.loop=value;this.manager.isLocked(this,"loop",value)||(this.audio&&(this.audio.loop=value),this.emit("loop",this,value))}},setLoop:function(value){this.loop=value;return this}});module.exports=
global}
//# sourceMappingURL=module$node_modules$Phaser$src$sound$html5$HTML5AudioSound.js.map
