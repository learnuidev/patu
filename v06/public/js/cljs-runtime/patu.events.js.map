{"version":3,"sources":["patu/events.cljs"],"mappings":"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","names":["patu.events/get-comp","id","cljs.core/deref","patu.state/state","cljs.core/name","patu.events/browse-comps","cljs.core.js__GT_clj","patu.events/browse-comps-raw","patu.events/evts-store","cljs.core.atom","patu.events/reg-event","handler","cljs.core.get","cljs.core.swap_BANG_","cljs.core/update","cljs.core/conj","cljs.core/assoc","patu.events/data->fn","cid","data","temp__5735__auto__","comp","seq__31975","cljs.core/seq","chunk__31976","count__31977","i__31978","vec__31985","cljs.core.nth","cljs.core/chunked-seq?","c__4556__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","vec__31988","cljs.core/first","cljs.core/next","k","v","cljs.core._EQ_","patu.events/dispatch-sync","props","temp__5733__auto__","handlers","seq__31991","chunk__31992","count__31993","i__31994","js/console.log","patu.events/dispatch","seq__31995","chunk__31996","count__31997","i__31998","res","G__32045","G__32046","G__32068","G__32069","cljs.core/vector?","cljs.core/Keyword","G__32047","G__32070","cljs.core/second","seq__32048","chunk__32049","count__32050","i__32051","seq__32071","chunk__32072","count__32073","i__32074","evt-vec","cljs.core/map?","seq__32052","chunk__32053","count__32054","i__32055","vec__32062","vec__32065","seq__32075","chunk__32076","count__32077","i__32078","vec__32085","vec__32088","patu.events/dispatch-n","seq__32091","chunk__32092","count__32093","i__32094"],"sourcesContent":["(ns patu.events\n  (:require  [patu.state :refer [state]]))\n\n;;\n(defn get-comp [id]\n  (.get_comp (:k @state) (name id)))\n\n(defn browse-comps []\n  (js->clj (.-components (.-state (:k @state)))\n           :keywordize-keys true))\n(defn browse-comps-raw []\n  (.-components (.-state (:k @state))))\n(comment\n  (browse-comps-raw)\n  (:x (:player (browse-comps)))\n  (.-x (.-pos (.-player (browse-comps-raw)))))\n\n(comment\n  (get-comp :ui/score))\n;; Game Events\n;; == 4. Event store\n(def evts-store (atom {}))\n\n(defn reg-event [id handler]\n  ;; Check if event is already registered\n  (if (get @evts-store id)\n    (swap! evts-store update id conj handler)\n    (swap! evts-store assoc id [handler])))\n\n(comment\n\n  @evts-store\n  (swap! evts-store assoc :foo [])\n  (swap! evts-store update :foo conj 1)\n  (swap! evts-store conj :foo 2))\n(comment\n  @evts-store)\n\n;;\n(defn data->fn  [cid data]\n  (when-let [comp (get-comp cid)]\n    (doseq [[k v] data]\n      (when (= k :x)\n        (set! (.. comp -pos -x) (+ (.. comp -pos -x) v)))\n      (when (= k :y)\n        (set! (.. comp -pos -y) (+ (.. comp -pos -y) v)))\n      (when (= k :value)\n        (set! comp -value v))\n      (when (= k :value)\n        (set! comp -text v)))))\n\n;;\n; (defn data->fn  [id data]\n;   (fn []\n;     (if (= js/Function (type data))\n;       (data)\n;       (doseq [[cid props] data]\n;         (if (= :dispatch cid)\n;           (dispatch props)\n;           (when-let [comp (get-comp cid)]\n;             (doseq [[k v] props]\n;               (when (= k :x)\n;                 (set! (.. comp -pos -x) (+ (.. comp -pos -x) v)))\n;               (when (= k :y)\n;                 (set! (.. comp -pos -y) (+ (.. comp -pos -y) v))))))))))\n\n\n(defn dispatch-sync [props]\n  (if-let [handlers (get @evts-store (nth props 0))]\n    (doseq [handler handlers]\n      (handler nil props))\n    (js/console.log (str \"No event handler registered for: \" (nth props 0)))))\n\n(defn dispatch [props]\n  (if-let [handlers (get @evts-store (nth props 0))]\n    (doseq [handler handlers]\n      (let [res (handler (browse-comps-raw) props)]\n        (when (vector? res)\n          ; (println \"RES: \" res)\n          (when (keyword? (first res))\n            (if (= :dispatch (first res))\n              (dispatch (second res))\n              (if (= :dispatch-n (first res))\n                (doseq [evt-vec (second res)]\n                  (dispatch evt-vec))\n                (data->fn (first res) (second res))))))\n        (when (map? res)\n          (doseq [[k v] res]\n            (when (keyword? k)\n              (if (= :dispatch k)\n                (dispatch v)\n                (data->fn k v)))))))\n    (js/console.log (str \"No event handler registered for: \" (nth props 0)))))\n\n(defn dispatch-n [data]\n  (doseq [props data]\n    (dispatch props)))\n"]}