shadow$provide.module$node_modules$Phaser$plugins$fbinstant$src$FacebookInstantGamesPlugin=function(global,require,module,exports){var AdInstance=require("module$node_modules$Phaser$plugins$fbinstant$src$AdInstance");global=require("module$node_modules$Phaser$src$utils$Class");var DataManager=require("module$node_modules$Phaser$src$data$DataManager"),EventEmitter=require("module$node_modules$eventemitter3$index"),Leaderboard=require("module$node_modules$Phaser$plugins$fbinstant$src$Leaderboard"),
Product=require("module$node_modules$Phaser$plugins$fbinstant$src$Product"),Purchase=require("module$node_modules$Phaser$plugins$fbinstant$src$Purchase");require=new global({Extends:EventEmitter,initialize:function(game){EventEmitter.call(this);this.game=game;this.data=new DataManager(this);this.on("setdata",this.setDataHandler,this);this.on("changedata",this.changeDataHandler,this);this.dataLocked=this.hasLoaded=!1;this.supportedAPIs=[];this.entryPoint="";this.playerPhotoURL=this.playerName=this.playerID=
this.version=this.platform=this.locale=this.contextType=this.contextID=this.entryPointData=null;this.paymentsReady=this.playerCanSubscribeBot=!1;this.catalog=[];this.purchases=[];this.leaderboards={};this.ads=[]},setDataHandler:function(parent,key,value){if(!this.dataLocked){var data={};data[key]=value;var _this=this;FBInstant.player.setDataAsync(data).then(function(){_this.emit("savedata",data)})}},changeDataHandler:function(parent,key,value){if(!this.dataLocked){var data={};data[key]=value;var _this=
this;FBInstant.player.setDataAsync(data).then(function(){_this.emit("savedata",data)})}},showLoadProgress:function(scene){scene.load.on("progress",function(value){this.hasLoaded||FBInstant.setLoadingProgress(100*value)},this);scene.load.on("complete",function(){this.hasLoaded||(this.hasLoaded=!0,FBInstant.startGameAsync().then(this.gameStarted.bind(this)))},this);return this},gameStarted:function(){var supported={},dotToUpper=function(match){return match[1].toUpperCase()};FBInstant.getSupportedAPIs().forEach(function(api){api=
api.replace(/\../g,dotToUpper);supported[api]=!0});this.supportedAPIs=supported;this.getID();this.getType();this.getLocale();this.getPlatform();this.getSDKVersion();this.getPlayerID();this.getPlayerName();this.getPlayerPhotoURL();var _this=this;FBInstant.onPause(function(){_this.emit("pause")});FBInstant.getEntryPointAsync().then(function(entrypoint){_this.entryPoint=entrypoint;_this.entryPointData=FBInstant.getEntryPointData();_this.emit("startgame")}).catch(function(e){console.warn(e)});this.supportedAPIs.paymentsPurchaseAsync&&
FBInstant.payments.onReady(function(){_this.paymentsReady=!0}).catch(function(e){console.warn(e)})},checkAPI:function(api){return this.supportedAPIs[api]?!0:!1},getID:function(){!this.contextID&&this.supportedAPIs.contextGetID&&(this.contextID=FBInstant.context.getID());return this.contextID},getType:function(){!this.contextType&&this.supportedAPIs.contextGetType&&(this.contextType=FBInstant.context.getType());return this.contextType},getLocale:function(){!this.locale&&this.supportedAPIs.getLocale&&
(this.locale=FBInstant.getLocale());return this.locale},getPlatform:function(){!this.platform&&this.supportedAPIs.getPlatform&&(this.platform=FBInstant.getPlatform());return this.platform},getSDKVersion:function(){!this.version&&this.supportedAPIs.getSDKVersion&&(this.version=FBInstant.getSDKVersion());return this.version},getPlayerID:function(){!this.playerID&&this.supportedAPIs.playerGetID&&(this.playerID=FBInstant.player.getID());return this.playerID},getPlayerName:function(){!this.playerName&&
this.supportedAPIs.playerGetName&&(this.playerName=FBInstant.player.getName());return this.playerName},getPlayerPhotoURL:function(){!this.playerPhotoURL&&this.supportedAPIs.playerGetPhoto&&(this.playerPhotoURL=FBInstant.player.getPhoto());return this.playerPhotoURL},loadPlayerPhoto:function(scene,key){this.playerPhotoURL&&(scene.load.setCORS("anonymous"),scene.load.image(key,this.playerPhotoURL),scene.load.once("filecomplete_image_"+key,function(){this.emit("photocomplete",key)},this),scene.load.start());
return this},canSubscribeBot:function(){if(this.supportedAPIs.playerCanSubscribeBotAsync){var _this=this;FBInstant.player.canSubscribeBotAsync().then(function(){_this.playerCanSubscribeBot=!0;_this.emit("cansubscribebot")}).catch(function(e){_this.emit("cansubscribebotfail",e)})}else this.emit("cansubscribebotfail");return this},subscribeBot:function(){if(this.playerCanSubscribeBot){var _this=this;FBInstant.player.subscribeBotAsync().then(function(){_this.emit("subscribebot")}).catch(function(e){_this.emit("subscribebotfail",
e)})}else this.emit("subscribebotfail");return this},getData:function(keys){if(!this.checkAPI("playerGetDataAsync"))return this;Array.isArray(keys)||(keys=[keys]);var _this=this;FBInstant.player.getDataAsync(keys).then(function(data){_this.dataLocked=!0;for(var key in data)_this.data.set(key,data[key]);_this.dataLocked=!1;_this.emit("getdata",data)});return this},saveData:function(data){if(!this.checkAPI("playerSetDataAsync"))return this;var _this=this;FBInstant.player.setDataAsync(data).then(function(){_this.emit("savedata",
data)}).catch(function(e){_this.emit("savedatafail",e)});return this},flushData:function(){if(!this.checkAPI("playerFlushDataAsync"))return this;var _this=this;FBInstant.player.flushDataAsync().then(function(){_this.emit("flushdata")}).catch(function(e){_this.emit("flushdatafail",e)});return this},getStats:function(keys){if(!this.checkAPI("playerGetStatsAsync"))return this;var _this=this;FBInstant.player.getStatsAsync(keys).then(function(data){_this.emit("getstats",data)}).catch(function(e){_this.emit("getstatsfail",
e)});return this},saveStats:function(data){if(!this.checkAPI("playerSetStatsAsync"))return this;var output={},key;for(key in data)"number"===typeof data[key]&&(output[key]=data[key]);var _this=this;FBInstant.player.setStatsAsync(output).then(function(){_this.emit("savestats",output)}).catch(function(e){_this.emit("savestatsfail",e)});return this},incStats:function(data){if(!this.checkAPI("playerIncrementStatsAsync"))return this;var output={},key;for(key in data)"number"===typeof data[key]&&(output[key]=
data[key]);var _this=this;FBInstant.player.incrementStatsAsync(output).then(function(stats){_this.emit("incstats",stats)}).catch(function(e){_this.emit("incstatsfail",e)});return this},saveSession:function(data){if(!this.checkAPI("setSessionData"))return this;1E3>=JSON.stringify(data).length?FBInstant.setSessionData(data):console.warn("Session data too long. Max 1000 chars.");return this},openShare:function(text,key,frame,sessionData){return this._share("SHARE",text,key,frame,sessionData)},openInvite:function(text,
key,frame,sessionData){return this._share("INVITE",text,key,frame,sessionData)},openRequest:function(text,key,frame,sessionData){return this._share("REQUEST",text,key,frame,sessionData)},openChallenge:function(text,key,frame,sessionData){return this._share("CHALLENGE",text,key,frame,sessionData)},_share:function(intent,text,key,frame,sessionData){if(!this.checkAPI("shareAsync"))return this;void 0===sessionData&&(sessionData={});if(key)var imageData=this.game.textures.getBase64(key,frame);var _this=
this;FBInstant.shareAsync({intent:intent,image:imageData,text:text,data:sessionData}).then(function(){_this.emit("resume")});return this},isSizeBetween:function(min,max){return this.checkAPI("contextIsSizeBetween")?FBInstant.context.isSizeBetween(min,max):this},switchContext:function(contextID){if(!this.checkAPI("contextSwitchAsync"))return this;if(contextID!==this.contextID){var _this=this;FBInstant.context.switchAsync(contextID).then(function(){_this.contextID=FBInstant.context.getID();_this.emit("switch",
_this.contextID)}).catch(function(e){_this.emit("switchfail",e)})}return this},chooseContext:function(options){if(!this.checkAPI("contextChoseAsync"))return this;var _this=this;FBInstant.context.chooseAsync(options).then(function(){_this.contextID=FBInstant.context.getID();_this.emit("choose",_this.contextID)}).catch(function(e){_this.emit("choosefail",e)});return this},createContext:function(playerID){if(!this.checkAPI("contextCreateAsync"))return this;var _this=this;FBInstant.context.createAsync(playerID).then(function(){_this.contextID=
FBInstant.context.getID();_this.emit("create",_this.contextID)}).catch(function(e){_this.emit("createfail",e)});return this},getPlayers:function(){if(!this.checkAPI("playerGetConnectedPlayersAsync"))return this;var _this=this;FBInstant.player.getConnectedPlayersAsync().then(function(players){_this.emit("players",players)}).catch(function(e){_this.emit("playersfail",e)});return this},getCatalog:function(){if(!this.paymentsReady)return this;var _this=this,catalog=this.catalog;FBInstant.payments.getCatalogAsync().then(function(data){catalog=
[];data.forEach(function(item){catalog.push(Product(item))});_this.emit("getcatalog",catalog)}).catch(function(e){_this.emit("getcatalogfail",e)});return this},purchase:function(productID,developerPayload){if(!this.paymentsReady)return this;productID={productID:productID};developerPayload&&(productID.developerPayload=developerPayload);var _this=this;FBInstant.payments.purchaseAsync(productID).then(function(data){data=Purchase(data);_this.emit("purchase",data)}).catch(function(e){_this.emit("purchasefail",
e)});return this},getPurchases:function(){if(!this.paymentsReady)return this;var _this=this,purchases=this.purchases;FBInstant.payments.getPurchasesAsync().then(function(data){purchases=[];data.forEach(function(item){purchases.push(Purchase(item))});_this.emit("getpurchases",purchases)}).catch(function(e){_this.emit("getpurchasesfail",e)});return this},consumePurchases:function(purchaseToken){if(!this.paymentsReady)return this;var _this=this;FBInstant.payments.consumePurchaseAsync(purchaseToken).then(function(){_this.emit("consumepurchase",
purchaseToken)}).catch(function(e){_this.emit("consumepurchasefail",e)});return this},update:function(cta,text,key,frame,template,updateData){return this._update("CUSTOM",cta,text,key,frame,template,updateData)},updateLeaderboard:function(cta,text,key,frame,template,updateData){return this._update("LEADERBOARD",cta,text,key,frame,template,updateData)},_update:function(action,cta,text,key,frame,template,updateData){if(!this.checkAPI("shareAsync"))return this;void 0===cta&&(cta="");"string"===typeof text&&
(text={default:text});void 0===updateData&&(updateData={});if(key)var imageData=this.game.textures.getBase64(key,frame);var _this=this;FBInstant.updateAsync({action:action,cta:cta,image:imageData,text:text,template:template,data:updateData,strategy:"IMMEDIATE",notification:"NO_PUSH"}).then(function(){_this.emit("update")}).catch(function(e){_this.emit("updatefail",e)});return this},switchGame:function(appID,data){if(!this.checkAPI("switchGameAsync"))return this;if(data&&1E3<JSON.stringify(data).length)return console.warn("Switch Game data too long. Max 1000 chars."),
this;var _this=this;FBInstant.switchGameAsync(appID,data).then(function(){_this.emit("switchgame",appID)}).catch(function(e){_this.emit("switchgamefail",e)});return this},createShortcut:function(){var _this=this;FBInstant.canCreateShortcutAsync().then(function(canCreateShortcut){canCreateShortcut&&FBInstant.createShortcutAsync().then(function(){_this.emit("shortcutcreated")}).catch(function(e){_this.emit("shortcutfailed",e)})});return this},quit:function(){FBInstant.quit()},log:function(name,value,
params){if(!this.checkAPI("logEvent"))return this;void 0===params&&(params={});2<=name.length&&40>=name.length&&FBInstant.logEvent(name,parseFloat(value),params);return this},preloadAds:function(placementID){if(!this.checkAPI("getInterstitialAdAsync"))return this;Array.isArray(placementID)||(placementID=[placementID]);var i,_this=this,total=0;for(i=0;i<this.ads.length;i++)this.ads[i].shown||total++;if(3<=total+placementID.length)return console.warn("Too many AdInstances. Show an ad before loading more"),
this;for(i=0;i<placementID.length;i++)FBInstant.getInterstitialAdAsync(placementID[i]).then(function(data){data=AdInstance(data,!0);_this.ads.push(data);return data.loadAsync()}).catch(function(e){console.warn(e)});return this},preloadVideoAds:function(placementID){if(!this.checkAPI("getRewardedVideoAsync"))return this;Array.isArray(placementID)||(placementID=[placementID]);var i,_this=this,total=0;for(i=0;i<this.ads.length;i++)this.ads[i].shown||total++;if(3<=total+placementID.length)return console.warn("Too many AdInstances. Show an ad before loading more"),
this;for(i=0;i<placementID.length;i++)FBInstant.getRewardedVideoAsync(placementID[i]).then(function(data){data=AdInstance(data,!0);_this.ads.push(data);return data.loadAsync()}).catch(function(e){console.warn(e)});return this},showAd:function(placementID){for(var _this=this,i=0;i<this.ads.length;i++){var ad=this.ads[i];ad.placementID===placementID&&ad.instance.showAsync().then(function(){ad.shown=!0;_this.emit("showad",ad)}).catch(function(e){"ADS_NO_FILL"===e.code?_this.emit("adsnofill"):console.warn(e)})}return this},
showVideo:function(placementID){for(var _this=this,i=0;i<this.ads.length;i++){var ad=this.ads[i];ad.placementID===placementID&&ad.video&&ad.instance.showAsync().then(function(){ad.shown=!0;_this.emit("showad",ad)}).catch(function(e){"ADS_NO_FILL"===e.code?_this.emit("adsnofill"):console.warn(e)})}return this},matchPlayer:function(matchTag,switchImmediately){void 0===matchTag&&(matchTag=null);void 0===switchImmediately&&(switchImmediately=!1);if(!this.checkAPI("matchPlayerAsync"))return this;var _this=
this;FBInstant.matchPlayerAsync(matchTag,switchImmediately).then(function(){_this.getID();_this.getType();_this.emit("matchplayer",_this.contextID,_this.contextType)});return this},getLeaderboard:function(name){if(!this.checkAPI("getLeaderboardAsync"))return this;var _this=this;FBInstant.getLeaderboardAsync(name).then(function(data){data=new Leaderboard(_this,data);_this.leaderboards[name]=data;_this.emit("getleaderboard",data)}).catch(function(e){console.warn(e)});return this},destroy:function(){FBInstant.quit();
this.data.destroy();this.removeAllListeners();this.catalog=[];this.purchases=[];this.leaderboards=[];this.ads=[];this.game=null}});module.exports=require}
//# sourceMappingURL=module$node_modules$Phaser$plugins$fbinstant$src$FacebookInstantGamesPlugin.js.map
