shadow$provide.module$node_modules$Phaser$src$renderer$canvas$CanvasRenderer=function(global,require,module,exports){var CanvasSnapshot=require("module$node_modules$Phaser$src$renderer$snapshot$CanvasSnapshot");global=require("module$node_modules$Phaser$src$utils$Class");var CONST=require("module$node_modules$Phaser$src$const"),GetBlendModes=require("module$node_modules$Phaser$src$renderer$canvas$utils$GetBlendModes"),ScaleModes=require("module$node_modules$Phaser$src$renderer$ScaleModes"),Smoothing=
require("module$node_modules$Phaser$src$display$canvas$Smoothing"),TransformMatrix=require("module$node_modules$Phaser$src$gameobjects$components$TransformMatrix");require=new global({initialize:function(game){this.game=game;this.type=CONST.CANVAS;this.drawCount=0;this.width=game.config.width;this.height=game.config.height;this.config={clearBeforeRender:game.config.clearBeforeRender,backgroundColor:game.config.backgroundColor,resolution:game.config.resolution,autoResize:game.config.autoResize,antialias:game.config.antialias,
roundPixels:game.config.roundPixels};this.scaleMode=game.config.antialias?ScaleModes.LINEAR:ScaleModes.NEAREST;this.gameCanvas=game.canvas;this.currentContext=this.gameContext=this.game.config.context?this.game.config.context:this.gameCanvas.getContext("2d");this.blendModes=GetBlendModes();this.currentScaleMode=0;this.snapshotEncoder=this.snapshotType=this.snapshotCallback=null;this._tempMatrix1=new TransformMatrix;this._tempMatrix2=new TransformMatrix;this._tempMatrix3=new TransformMatrix;this._tempMatrix4=
new TransformMatrix;this.init()},init:function(){this.resize(this.width,this.height)},resize:function(width,height){var resolution=this.config.resolution;this.width=width*resolution;this.height=height*resolution;this.gameCanvas.width=this.width;this.gameCanvas.height=this.height;this.config.autoResize&&(this.gameCanvas.style.width=this.width/resolution+"px",this.gameCanvas.style.height=this.height/resolution+"px");this.scaleMode===ScaleModes.NEAREST&&Smoothing.disable(this.gameContext)},onContextLost:function(){},
onContextRestored:function(){},resetTransform:function(){this.currentContext.setTransform(1,0,0,1,0,0)},setBlendMode:function(blendMode){this.currentContext.globalCompositeOperation=blendMode;return this},setContext:function(ctx){this.currentContext=ctx?ctx:this.gameContext;return this},setAlpha:function(alpha){this.currentContext.globalAlpha=alpha;return this},preRender:function(){var ctx=this.gameContext,config=this.config,width=this.width,height=this.height;config.clearBeforeRender&&ctx.clearRect(0,
0,width,height);config.transparent||(ctx.fillStyle=config.backgroundColor.rgba,ctx.fillRect(0,0,width,height));this.drawCount=0},render:function(scene,children,interpolationPercentage,camera){children=children.list;var childCount=children.length,cx=camera._cx,cy=camera._cy,cw=camera._cw,ch=camera._ch,ctx=camera.renderToTexture?camera.context:scene.sys.context,scissor=0!==cx||0!==cy||cw!==ctx.canvas.width||ch!==ctx.canvas.height;this.currentContext=ctx;camera.transparent||(ctx.fillStyle=camera.backgroundColor.rgba,
ctx.fillRect(cx,cy,cw,ch));ctx.globalAlpha=camera.alpha;ctx.globalCompositeOperation="source-over";this.drawCount+=children.length;scissor&&(ctx.save(),ctx.beginPath(),ctx.rect(cx,cy,cw,ch),ctx.clip());camera.renderToTexture&&camera.emit("prerender",camera);camera.matrix.copyToContext(ctx);for(cw=0;cw<childCount;cw++)ch=children[cw],ch.willRender(camera)&&(ch.mask&&ch.mask.preRenderCanvas(this,ch,camera),ch.renderCanvas(this,ch,interpolationPercentage,camera),ch.mask&&ch.mask.postRenderCanvas(this,
ch,camera));ctx.setTransform(1,0,0,1,0,0);ctx.globalCompositeOperation="source-over";ctx.globalAlpha=1;camera.flashEffect.postRenderCanvas(ctx);camera.fadeEffect.postRenderCanvas(ctx);camera.dirty=!1;scissor&&ctx.restore();camera.renderToTexture&&(camera.emit("postrender",camera),scene.sys.context.drawImage(camera.canvas,cx,cy))},postRender:function(){var ctx=this.gameContext;ctx.globalAlpha=1;ctx.globalCompositeOperation="source-over";this.snapshotCallback&&(this.snapshotCallback(CanvasSnapshot(this.gameCanvas,
this.snapshotType,this.snapshotEncoder)),this.snapshotCallback=null)},snapshot:function(callback,type,encoderOptions){this.snapshotCallback=callback;this.snapshotType=type;this.snapshotEncoder=encoderOptions},batchSprite:function(sprite,frame,camera,parentTransformMatrix){var alpha=camera.alpha*sprite.alpha;if(0!==alpha){var ctx=this.currentContext,camMatrix=this._tempMatrix1,spriteMatrix=this._tempMatrix2,calcMatrix=this._tempMatrix3,cd=frame.canvasData,frameX=cd.x;cd=cd.y;var frameWidth=frame.cutWidth,
frameHeight=frame.cutHeight,res=frame.source.resolution,x=-sprite.displayOriginX+frame.x,y=-sprite.displayOriginY+frame.y,fx=sprite.flipX?-1:1,fy=sprite.flipY?-1:1;sprite.isCropped&&(y=sprite._crop,y.flipX===sprite.flipX&&y.flipY===sprite.flipY||frame.updateCropUVs(y,sprite.flipX,sprite.flipY),frameWidth=y.cw,frameHeight=y.ch,frameX=y.cx,cd=y.cy,x=-sprite.displayOriginX+y.x,y=-sprite.displayOriginY+y.y,-1===fx&&(0<=x?x=-(x+frameWidth):0>x&&(x=Math.abs(x)-frameWidth)),-1===fy&&(0<=y?y=-(y+frameHeight):
0>y&&(y=Math.abs(y)-frameHeight)));spriteMatrix.applyITRS(sprite.x,sprite.y,sprite.rotation,sprite.scaleX,sprite.scaleY);camMatrix.copyFrom(camera.matrix);parentTransformMatrix?(camMatrix.multiplyWithOffset(parentTransformMatrix,-camera.scrollX*sprite.scrollFactorX,-camera.scrollY*sprite.scrollFactorY),spriteMatrix.e=sprite.x,spriteMatrix.f=sprite.y):(spriteMatrix.e-=camera.scrollX*sprite.scrollFactorX,spriteMatrix.f-=camera.scrollY*sprite.scrollFactorY);camMatrix.multiply(spriteMatrix,calcMatrix);
ctx.save();calcMatrix.setToContext(ctx);ctx.scale(fx,fy);ctx.globalCompositeOperation=this.blendModes[sprite.blendMode];ctx.globalAlpha=alpha;ctx.drawImage(frame.source.image,frameX,cd,frameWidth,frameHeight,x,y,frameWidth/res,frameHeight/res);ctx.restore()}},destroy:function(){this.game=this.gameContext=this.gameCanvas=null}});module.exports=require}
//# sourceMappingURL=module$node_modules$Phaser$src$renderer$canvas$CanvasRenderer.js.map
