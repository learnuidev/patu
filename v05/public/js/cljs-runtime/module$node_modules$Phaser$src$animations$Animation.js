shadow$provide.module$node_modules$Phaser$src$animations$Animation=function(global,require,module,exports){var Clamp=require("module$node_modules$Phaser$src$math$Clamp");global=require("module$node_modules$Phaser$src$utils$Class");var FindClosestInSorted=require("module$node_modules$Phaser$src$utils$array$FindClosestInSorted"),Frame=require("module$node_modules$Phaser$src$animations$AnimationFrame"),GetValue=require("module$node_modules$Phaser$src$utils$object$GetValue");require=new global({initialize:function(manager,
key,config){this.manager=manager;this.key=key;this.type="frame";this.frames=this.getFrames(manager.textureManager,GetValue(config,"frames",[]),GetValue(config,"defaultTextureKey",null));this.frameRate=GetValue(config,"frameRate",null);this.duration=GetValue(config,"duration",null);null===this.duration&&null===this.frameRate?(this.frameRate=24,this.duration=this.frameRate/this.frames.length*1E3):this.duration&&null===this.frameRate?this.frameRate=this.frames.length/(this.duration/1E3):this.duration=
this.frames.length/this.frameRate*1E3;this.msPerFrame=1E3/this.frameRate;this.skipMissedFrames=GetValue(config,"skipMissedFrames",!0);this.delay=GetValue(config,"delay",0);this.repeat=GetValue(config,"repeat",0);this.repeatDelay=GetValue(config,"repeatDelay",0);this.yoyo=GetValue(config,"yoyo",!1);this.showOnStart=GetValue(config,"showOnStart",!1);this.hideOnComplete=GetValue(config,"hideOnComplete",!1);this.paused=!1;this.manager.on("pauseall",this.pause,this);this.manager.on("resumeall",this.resume,
this)},addFrame:function(config){return this.addFrameAt(this.frames.length,config)},addFrameAt:function(index,config){config=this.getFrames(this.manager.textureManager,config);if(0<config.length){if(0===index)this.frames=config.concat(this.frames);else if(index===this.frames.length)this.frames=this.frames.concat(config);else{var pre=this.frames.slice(0,index);index=this.frames.slice(index);this.frames=pre.concat(config,index)}this.updateFrameSequence()}return this},checkFrame:function(index){return 0<=
index&&index<this.frames.length},completeAnimation:function(component){this.hideOnComplete&&(component.parent.visible=!1);component.stop()},getFirstTick:function(component,includeDelay){void 0===includeDelay&&(includeDelay=!0);component.accumulator=0;component.nextTick=component.msPerFrame+component.currentFrame.duration;includeDelay&&(component.nextTick+=component._delay)},getFrameAt:function(index){return this.frames[index]},getFrames:function(textureManager,frames,defaultTextureKey){var out=[],
index=1;if("string"===typeof frames){var textureKey=frames;var i=textureManager.get(textureKey).getFrameNames();frames=[];i.forEach(function(idx,value){frames.push({key:textureKey,frame:value})})}if(!Array.isArray(frames)||0===frames.length)return out;for(i=0;i<frames.length;i++){var item=frames[i],key=GetValue(item,"key",defaultTextureKey);if(key){var animationFrame=GetValue(item,"frame",0);var textureFrame=textureManager.getFrame(key,animationFrame);animationFrame=new Frame(key,animationFrame,index,
textureFrame);animationFrame.duration=GetValue(item,"duration",0);animationFrame.isFirst=!prev;prev&&(prev.nextFrame=animationFrame,animationFrame.prevFrame=prev);out.push(animationFrame);var prev=animationFrame;index++}}if(0<out.length)for(animationFrame.isLast=!0,animationFrame.nextFrame=out[0],out[0].prevFrame=animationFrame,textureManager=1/(out.length-1),i=0;i<out.length;i++)out[i].progress=i*textureManager;return out},getNextTick:function(component){component.accumulator-=component.nextTick;
component.nextTick=component.msPerFrame+component.currentFrame.duration},load:function(component,startFrame){startFrame>=this.frames.length&&(startFrame=0);component.currentAnim!==this&&(component.currentAnim=this,component.frameRate=this.frameRate,component.duration=this.duration,component.msPerFrame=this.msPerFrame,component.skipMissedFrames=this.skipMissedFrames,component._delay=this.delay,component._repeat=this.repeat,component._repeatDelay=this.repeatDelay,component._yoyo=this.yoyo);var frame=
this.frames[startFrame];0!==startFrame||component.forward||(frame=this.getLastFrame());component.updateFrame(frame)},getFrameByProgress:function(value){value=Clamp(value,0,1);return FindClosestInSorted(value,this.frames,"progress")},nextFrame:function(component){var frame=component.currentFrame;frame.isLast?component._yoyo?this.handleYoyoFrame(component,!1):0<component.repeatCounter?component._reverse&&component.forward?component.forward=!1:this.repeatAnimation(component):this.completeAnimation(component):
this.updateAndGetNextTick(component,frame.nextFrame)},handleYoyoFrame:function(component,isReverse){isReverse||(isReverse=!1);component._reverse===!isReverse&&0<component.repeatCounter?(component.forward=isReverse,this.repeatAnimation(component)):component._reverse!==isReverse&&0===component.repeatCounter?this.completeAnimation(component):(component.forward=isReverse,this.updateAndGetNextTick(component,isReverse?component.currentFrame.nextFrame:component.currentFrame.prevFrame))},getLastFrame:function(){return this.frames[this.frames.length-
1]},previousFrame:function(component){var frame=component.currentFrame;frame.isFirst?component._yoyo?this.handleYoyoFrame(component,!0):0<component.repeatCounter?(component._reverse&&!component.forward?component.currentFrame=this.getLastFrame():component.forward=!0,this.repeatAnimation(component)):this.completeAnimation(component):this.updateAndGetNextTick(component,frame.prevFrame)},updateAndGetNextTick:function(component,frame){component.updateFrame(frame);this.getNextTick(component)},removeFrame:function(frame){frame=
this.frames.indexOf(frame);-1!==frame&&this.removeFrameAt(frame);return this},removeFrameAt:function(index){this.frames.splice(index,1);this.updateFrameSequence();return this},repeatAnimation:function(component){if(2===component._pendingStop)return this.completeAnimation(component);0<component._repeatDelay&&!1===component.pendingRepeat?(component.pendingRepeat=!0,component.accumulator-=component.nextTick,component.nextTick+=component._repeatDelay):(component.repeatCounter--,component.updateFrame(component.currentFrame[component.forward?
"nextFrame":"prevFrame"]),component.isPlaying&&(this.getNextTick(component),component.pendingRepeat=!1,component.parent.emit("animationrepeat",this,component.currentFrame,component.repeatCounter,component.parent)))},setFrame:function(component){component.forward?this.nextFrame(component):this.previousFrame(component)},toJSON:function(){var output={key:this.key,type:this.type,frames:[],frameRate:this.frameRate,duration:this.duration,skipMissedFrames:this.skipMissedFrames,delay:this.delay,repeat:this.repeat,
repeatDelay:this.repeatDelay,yoyo:this.yoyo,showOnStart:this.showOnStart,hideOnComplete:this.hideOnComplete};this.frames.forEach(function(frame){output.frames.push(frame.toJSON())});return output},updateFrameSequence:function(){for(var len=this.frames.length,slice=1/(len-1),i=0;i<len;i++){var frame=this.frames[i];frame.index=i+1;frame.isFirst=!1;frame.isLast=!1;frame.progress=i*slice;0===i?(frame.isFirst=!0,frame.isLast=1===len,frame.prevFrame=this.frames[len-1],frame.nextFrame=this.frames[i+1]):
i===len-1?(frame.isLast=!0,frame.prevFrame=this.frames[len-2],frame.nextFrame=this.frames[0]):1<len&&(frame.prevFrame=this.frames[i-1],frame.nextFrame=this.frames[i+1])}return this},pause:function(){this.paused=!0;return this},resume:function(){this.paused=!1;return this},destroy:function(){this.manager.off("pauseall",this.pause,this);this.manager.off("resumeall",this.resume,this);this.manager.remove(this.key);for(var i=0;i<this.frames.length;i++)this.frames[i].destroy();this.frames=[];this.manager=
null}});module.exports=require}
//# sourceMappingURL=module$node_modules$Phaser$src$animations$Animation.js.map
