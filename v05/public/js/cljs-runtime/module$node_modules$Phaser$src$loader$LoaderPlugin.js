shadow$provide.module$node_modules$Phaser$src$loader$LoaderPlugin=function(global,require,module,exports){exports=require("module$node_modules$Phaser$src$utils$Class");var CONST=require("module$node_modules$Phaser$src$loader$const"),CustomSet=require("module$node_modules$Phaser$src$structs$Set"),EventEmitter=require("module$node_modules$eventemitter3$index"),FileTypesManager=require("module$node_modules$Phaser$src$loader$FileTypesManager"),GetFastValue=require("module$node_modules$Phaser$src$utils$object$GetFastValue");
global=require("module$node_modules$Phaser$src$plugins$PluginCache");var XHRSettings=require("module$node_modules$Phaser$src$loader$XHRSettings");require=new exports({Extends:EventEmitter,initialize:function(scene){EventEmitter.call(this);var gameConfig=scene.sys.game.config,sceneConfig=scene.sys.settings.loader;this.scene=scene;this.systems=scene.sys;this.cacheManager=scene.sys.cache;this.textureManager=scene.sys.textures;FileTypesManager.install(this);this.baseURL=this.path=this.prefix="";this.setBaseURL(GetFastValue(sceneConfig,
"baseURL",gameConfig.loaderBaseURL));this.setPath(GetFastValue(sceneConfig,"path",gameConfig.loaderPath));this.setPrefix(GetFastValue(sceneConfig,"prefix",gameConfig.loaderPrefix));this.maxParallelDownloads=GetFastValue(sceneConfig,"maxParallelDownloads",gameConfig.loaderMaxParallelDownloads);this.xhr=XHRSettings(GetFastValue(sceneConfig,"responseType",gameConfig.loaderResponseType),GetFastValue(sceneConfig,"async",gameConfig.loaderAsync),GetFastValue(sceneConfig,"user",gameConfig.loaderUser),GetFastValue(sceneConfig,
"password",gameConfig.loaderPassword),GetFastValue(sceneConfig,"timeout",gameConfig.loaderTimeout));this.crossOrigin=GetFastValue(sceneConfig,"crossOrigin",gameConfig.loaderCrossOrigin);this.progress=this.totalToLoad=0;this.list=new CustomSet;this.inflight=new CustomSet;this.queue=new CustomSet;this._deleteQueue=new CustomSet;this.totalComplete=this.totalFailed=0;this.state=CONST.LOADER_IDLE;scene.sys.events.once("boot",this.boot,this);scene.sys.events.on("start",this.pluginStart,this)},boot:function(){this.systems.events.once("destroy",
this.destroy,this)},pluginStart:function(){this.systems.events.once("shutdown",this.shutdown,this)},setBaseURL:function(url){void 0===url&&(url="");""!==url&&"/"!==url.substr(-1)&&(url=url.concat("/"));this.baseURL=url;return this},setPath:function(path){void 0===path&&(path="");""!==path&&"/"!==path.substr(-1)&&(path=path.concat("/"));this.path=path;return this},setPrefix:function(prefix){void 0===prefix&&(prefix="");this.prefix=prefix;return this},setCORS:function(crossOrigin){this.crossOrigin=
crossOrigin;return this},addFile:function(file){Array.isArray(file)||(file=[file]);for(var i=0;i<file.length;i++){var item=file[i];this.keyExists(item)||(this.list.set(item),this.emit("addfile",item.key,item.type,this,item),this.isLoading()&&(this.totalToLoad++,this.updateProgress()))}},keyExists:function(file){var keyConflict=file.hasCacheConflict();keyConflict||this.list.iterate(function(item){if(item.type===file.type&&item.key===file.key)return keyConflict=!0,!1});!keyConflict&&this.isLoading()&&
(this.inflight.iterate(function(item){if(item.type===file.type&&item.key===file.key)return keyConflict=!0,!1}),this.queue.iterate(function(item){if(item.type===file.type&&item.key===file.key)return keyConflict=!0,!1}));return keyConflict},addPack:function(pack,packKey){packKey&&pack.hasOwnProperty(packKey)&&(pack={packKey:pack[packKey]});packKey=0;var currentBaseURL=this.baseURL,currentPath=this.path,currentPrefix=this.prefix,key;for(key in pack){var config=pack[key],baseURL=GetFastValue(config,"baseURL",
currentBaseURL),path=GetFastValue(config,"path",currentPath),prefix=GetFastValue(config,"prefix",currentPrefix),files=GetFastValue(config,"files",null);config=GetFastValue(config,"defaultType","void");if(Array.isArray(files))for(this.setBaseURL(baseURL),this.setPath(path),this.setPrefix(prefix),baseURL=0;baseURL<files.length;baseURL++)path=files[baseURL],prefix=path.hasOwnProperty("type")?path.type:config,this[prefix]&&(this[prefix](path),packKey++)}this.setBaseURL(currentBaseURL);this.setPath(currentPath);
this.setPrefix(currentPrefix);return 0<packKey},isLoading:function(){return this.state===CONST.LOADER_LOADING||this.state===CONST.LOADER_PROCESSING},isReady:function(){return this.state===CONST.LOADER_IDLE||this.state===CONST.LOADER_COMPLETE},start:function(){this.isReady()&&(this.totalComplete=this.totalFailed=this.progress=0,this.totalToLoad=this.list.size,this.emit("start",this),0===this.list.size?this.loadComplete():(this.state=CONST.LOADER_LOADING,this.inflight.clear(),this.queue.clear(),this.updateProgress(),
this.checkLoadQueue(),this.systems.events.on("update",this.update,this)))},updateProgress:function(){this.progress=1-(this.list.size+this.inflight.size)/this.totalToLoad;this.emit("progress",this.progress)},update:function(){this.state===CONST.LOADER_LOADING&&0<this.list.size&&this.inflight.size<this.maxParallelDownloads&&this.checkLoadQueue()},checkLoadQueue:function(){this.list.each(function(file){if(file.state===CONST.FILE_POPULATED||file.state===CONST.FILE_PENDING&&this.inflight.size<this.maxParallelDownloads)this.inflight.set(file),
this.list.delete(file),file.crossOrigin||(file.crossOrigin=this.crossOrigin),file.load();if(this.inflight.size===this.maxParallelDownloads)return!1},this)},nextFile:function(file,success){this.inflight&&(this.inflight.delete(file),this.updateProgress(),success?(this.totalComplete++,this.queue.set(file),this.emit("load",file),file.onProcess()):(this.totalFailed++,this._deleteQueue.set(file),this.emit("loaderror",file),this.fileProcessComplete(file)))},fileProcessComplete:function(file){if(this.scene&&
this.systems&&this.systems.game&&!this.systems.game.pendingDestroy){if(file.state===CONST.FILE_ERRORED){if(file.multiFile)file.multiFile.onFileFailed(file)}else file.state===CONST.FILE_COMPLETE&&(file.multiFile?file.multiFile.isReadyToProcess()&&file.multiFile.addToCache():file.addToCache());this.queue.delete(file);0===this.list.size&&0===this.inflight.size&&0===this.queue.size&&this.loadComplete()}},loadComplete:function(){this.emit("loadcomplete",this);this.list.clear();this.inflight.clear();this.queue.clear();
this.progress=1;this.state=CONST.LOADER_COMPLETE;this.systems.events.off("update",this.update,this);this._deleteQueue.iterateLocal("destroy");this._deleteQueue.clear();this.emit("complete",this,this.totalComplete,this.totalFailed)},flagForRemoval:function(file){this._deleteQueue.set(file)},saveJSON:function(data,filename){return this.save(JSON.stringify(data),filename)},save:function(data,filename,filetype){void 0===filename&&(filename="file.json");void 0===filetype&&(filetype="application/json");
data=new Blob([data],{type:filetype});data=URL.createObjectURL(data);filetype=document.createElement("a");filetype.download=filename;filetype.textContent="Download "+filename;filetype.href=data;filetype.click();return this},reset:function(){this.list.clear();this.inflight.clear();this.queue.clear();var gameConfig=this.systems.game.config,sceneConfig=this.systems.settings.loader;this.setBaseURL(GetFastValue(sceneConfig,"baseURL",gameConfig.loaderBaseURL));this.setPath(GetFastValue(sceneConfig,"path",
gameConfig.loaderPath));this.setPrefix(GetFastValue(sceneConfig,"prefix",gameConfig.loaderPrefix));this.state=CONST.LOADER_IDLE},shutdown:function(){this.reset();this.state=CONST.LOADER_SHUTDOWN;this.systems.events.off("update",this.update,this);this.systems.events.off("shutdown",this.shutdown,this)},destroy:function(){this.shutdown();this.state=CONST.LOADER_DESTROYED;this.systems.events.off("update",this.update,this);this.systems.events.off("start",this.pluginStart,this);this.cacheManager=this.textureManager=
this.systems=this.scene=this.queue=this.inflight=this.list=null}});global.register("Loader",require,"load");module.exports=require}
//# sourceMappingURL=module$node_modules$Phaser$src$loader$LoaderPlugin.js.map
