shadow$provide.module$node_modules$Phaser$src$sound$webaudio$WebAudioSound=function(global,require,module,exports){var BaseSound=require("module$node_modules$Phaser$src$sound$BaseSound");global=new (require("module$node_modules$Phaser$src$utils$Class"))({Extends:BaseSound,initialize:function(manager,key,config){void 0===config&&(config={});(this.audioBuffer=manager.game.cache.audio.get(key))?(this.loopSource=this.source=null,this.muteNode=manager.context.createGain(),this.volumeNode=manager.context.createGain(),
this.loopTime=this.startTime=this.playTime=0,this.rateUpdates=[],this.hasLooped=this.hasEnded=!1,this.muteNode.connect(this.volumeNode),this.volumeNode.connect(manager.destination),this.totalDuration=this.duration=this.audioBuffer.duration,BaseSound.call(this,manager,key,config)):console.warn("Audio cache entry missing: "+key)},play:function(markerName,config){if(!BaseSound.prototype.play.call(this,markerName,config))return!1;this.stopAndRemoveBufferSource();this.createAndStartBufferSource();this.emit("play",
this);return!0},pause:function(){if(this.manager.context.currentTime<this.startTime||!BaseSound.prototype.pause.call(this))return!1;this.currentConfig.seek=this.getCurrentTime();this.stopAndRemoveBufferSource();this.emit("pause",this);return!0},resume:function(){if(this.manager.context.currentTime<this.startTime||!BaseSound.prototype.resume.call(this))return!1;this.createAndStartBufferSource();this.emit("resume",this);return!0},stop:function(){if(!BaseSound.prototype.stop.call(this))return!1;this.stopAndRemoveBufferSource();
this.emit("stop",this);return!0},createAndStartBufferSource:function(){var seek=this.currentConfig.seek,when=this.manager.context.currentTime+this.currentConfig.delay,offset=(this.currentMarker?this.currentMarker.start:0)+seek,duration=this.duration-seek;this.playTime=when-seek;this.startTime=when;this.source=this.createBufferSource();this.applyConfig();this.source.start(Math.max(0,when),Math.max(0,offset),Math.max(0,duration));this.resetConfig()},createAndStartLoopBufferSource:function(){var when=
this.getLoopTime(),offset=this.currentMarker?this.currentMarker.start:0,duration=this.duration;this.loopTime=when;this.loopSource=this.createBufferSource();this.loopSource.playbackRate.setValueAtTime(this.totalRate,0);this.loopSource.start(Math.max(0,when),Math.max(0,offset),Math.max(0,duration))},createBufferSource:function(){var _this=this,source=this.manager.context.createBufferSource();source.buffer=this.audioBuffer;source.connect(this.muteNode);source.onended=function(ev){ev.target===_this.source&&
(_this.currentConfig.loop?_this.hasLooped=!0:_this.hasEnded=!0)};return source},stopAndRemoveBufferSource:function(){this.source&&(this.source.stop(),this.source.disconnect(),this.source=null);this.startTime=this.playTime=0;this.stopAndRemoveLoopBufferSource()},stopAndRemoveLoopBufferSource:function(){this.loopSource&&(this.loopSource.stop(),this.loopSource.disconnect(),this.loopSource=null);this.loopTime=0},applyConfig:function(){this.rateUpdates.length=0;this.rateUpdates.push({time:0,rate:1});BaseSound.prototype.applyConfig.call(this)},
update:function(time,delta){this.hasEnded?(this.hasEnded=!1,BaseSound.prototype.stop.call(this),this.stopAndRemoveBufferSource(),this.emit("ended",this)):this.hasLooped&&(this.hasLooped=!1,this.source=this.loopSource,this.loopSource=null,this.playTime=this.startTime=this.loopTime,this.rateUpdates.length=0,this.rateUpdates.push({time:0,rate:this.totalRate}),this.createAndStartLoopBufferSource(),this.emit("looped",this))},destroy:function(){BaseSound.prototype.destroy.call(this);this.audioBuffer=null;
this.stopAndRemoveBufferSource();this.muteNode.disconnect();this.muteNode=null;this.volumeNode.disconnect();this.volumeNode=null;this.rateUpdates.length=0;this.rateUpdates=null},calculateRate:function(){BaseSound.prototype.calculateRate.call(this);var now=this.manager.context.currentTime;this.source&&"number"===typeof this.totalRate&&this.source.playbackRate.setValueAtTime(this.totalRate,now);this.isPlaying&&(this.rateUpdates.push({time:Math.max(this.startTime,now)-this.playTime,rate:this.totalRate}),
this.loopSource&&(this.stopAndRemoveLoopBufferSource(),this.createAndStartLoopBufferSource()))},getCurrentTime:function(){for(var currentTime=0,i=0;i<this.rateUpdates.length;i++)currentTime+=((i<this.rateUpdates.length-1?this.rateUpdates[i+1].time:this.manager.context.currentTime-this.playTime)-this.rateUpdates[i].time)*this.rateUpdates[i].rate;return currentTime},getLoopTime:function(){for(var lastRateUpdateCurrentTime=0,i=0;i<this.rateUpdates.length-1;i++)lastRateUpdateCurrentTime+=(this.rateUpdates[i+
1].time-this.rateUpdates[i].time)*this.rateUpdates[i].rate;i=this.rateUpdates[this.rateUpdates.length-1];return this.playTime+i.time+(this.duration-lastRateUpdateCurrentTime)/i.rate},rate:{get:function(){return this.currentConfig.rate},set:function(value){this.currentConfig.rate=value;this.calculateRate();this.emit("rate",this,value)}},setRate:function(value){this.rate=value;return this},detune:{get:function(){return this.currentConfig.detune},set:function(value){this.currentConfig.detune=value;this.calculateRate();
this.emit("detune",this,value)}},setDetune:function(value){this.detune=value;return this},mute:{get:function(){return 0===this.muteNode.gain.value},set:function(value){this.currentConfig.mute=value;this.muteNode.gain.setValueAtTime(value?0:1,0);this.emit("mute",this,value)}},setMute:function(value){this.mute=value;return this},volume:{get:function(){return this.volumeNode.gain.value},set:function(value){this.currentConfig.volume=value;this.volumeNode.gain.setValueAtTime(value,0);this.emit("volume",
this,value)}},setVolume:function(value){this.volume=value;return this},seek:{get:function(){return this.isPlaying?this.manager.context.currentTime<this.startTime?this.startTime-this.playTime:this.getCurrentTime():this.isPaused?this.currentConfig.seek:0},set:function(value){this.manager.context.currentTime<this.startTime||!this.isPlaying&&!this.isPaused||(value=Math.min(Math.max(0,value),this.duration),this.currentConfig.seek=value,this.isPlaying&&(this.stopAndRemoveBufferSource(),this.createAndStartBufferSource()),
this.emit("seek",this,value))}},setSeek:function(value){this.seek=value;return this},loop:{get:function(){return this.currentConfig.loop},set:function(value){this.currentConfig.loop=value;this.isPlaying&&(this.stopAndRemoveLoopBufferSource(),value&&this.createAndStartLoopBufferSource());this.emit("loop",this,value)}},setLoop:function(value){this.loop=value;return this}});module.exports=global}
//# sourceMappingURL=module$node_modules$Phaser$src$sound$webaudio$WebAudioSound.js.map
